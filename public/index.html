<!DOCTYPE html>
<html lang="en">
  <head>
    <title>mpos-precept</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css" />
    <script src="opencv.js" async></script>
    <script src="//cdn.jsdelivr.net/npm/libgif@0.0.3/libgif.min.js" async></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.172.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.172.0/examples/jsm/"
        }
      }
    </script>
  </head>
  <body class="mp-unstyle">
    <div id="errorMessage"></div>
    <main>
      <h2 class="mp-native">
        <span>main</span>
        <label class="cycle">
          <input name="cycles" type="checkbox" checked onChange="document.body.classList.toggle('mp-unstyle')" />
          cycle
        </label>
      </h2>
      <p class="cycle stage" id="overflow">
        differ tween: passive, overflow<br />
        <span id="fragment" contenteditable style="color: red">
          <style>
            #fragment {
              /* some properties don't cascade */
              background-color: rgba(255, 0, 0, 0.75);
              text-shadow: 0.05em 0.125em 0.025em #fff;
              box-shadow: inset 0em 0.2em 0.05em 0em #000;
            }
            .score {
              background-color: rgba(0, 255, 0, 0.25);
            }
          </style>
          <span class="score">#fragment</span>
        </span>
        <br />
        Update queue attribute from cache of split-priority.<br />
      </p>
      <details id="tools" class="mp-allow" open>
        <summary>Static Content</summary>

        <div class="stage" id="underflow"></div>
        <aside id="native" class="tilt scroll">
          <h2>aside<span>#native</span></h2>
          <form onSubmit="return false;">
            <fieldset class="sub">
              <legend>form</legend>
              <input name="listen" class="w50" type="text" placeholder="listen" />
              <input class="w25" type="button" value="&#x2714;" />
              <input class="w25" type="reset" value="&#x2716;" />
              <input class="w100" type="range" />
            </fieldset>
          </form>
          <div>
            <h2>tag cloud</h2>
            <span style="position: relative; z-index: 9">click</span>
            <span style="position: relative; z-index: 0">mousemove</span>
            <span style="position: relative; z-index: -6">mousedown</span>
            <span style="position: relative; z-index: 6">mouseup</span>
            <span style="position: relative; z-index: -3">mouseout</span>
            <span style="position: relative; z-index: 3">mouseover</span>
          </div>
        </aside>
        <section id="text">
          <h2>section<span>#text</span></h2>
          \n TEXT NODE \n
          <ul class="tilt">
            <h3>deep list</h3>
            <li>
              A. AAAAAAAA
              <ol>
                <li>
                  1. 11111111
                  <ul>
                    <li>a. aaaaaaaa</li>
                    <li>b. bbbbbbbb</li>
                    <li>c. cccccccc</li>
                  </ul>
                </li>
                <li>2. 22222222</li>
                <li>3. 33333333</li>
              </ol>
            </li>
            <li>B. BBBBBBBB</li>
            <li>C. CCCCCCCC</li>
          </ul>
          <div id="nest" class="resize">
            <div>
              <div>
                <div>1</div>
                <div>2</div>
              </div>
              <div>
                3
                <a href="//discourse.threejs.org" target="_blank">4</a>
              </div>
            </div>
            <div>
              <div>
                <div>
                  <div><a href="#">A</a></div>
                  <div>B</div>
                </div>
                <div><span></span><span></span></div>
              </div>
              <div>
                <div>7</div>
                <div>8</div>
              </div>
            </div>
          </div>
        </section>
        <section id="loader">
          <h2>section<span>#loader</span></h2>
          <p class="mp-loader">Class <span class="sup">mp-loader</span> TXT2IMG?</p>
          <object class="mp-loader w33 hinge" data="//upload.wikimedia.org/wikipedia/commons/d/dd/Wheelchair_stairs.svg?t=20"></object>
          <img alt="" class="mp-loader w33 hinge" src="./image.jpg?t=21" crossorigin="anonymous" />
          <img alt="" class="mp-loader w33 hinge" src="./image.gif?t=21" />
          <video class="mp-loader w33 hinge" crossorigin="anonymous" loop autoplay muted>
            <source src="//interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.webm" type="video/webm" />
            <source src="//interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4" type="video/mp4" />
          </video>
          <div class="w33" id="Object3D"></div>
        </section>
        <section id="media" class="sub">
          <h2>section<span>#media</span></h2>
          <article>
            <img alt="" class="w33 hinge" src="./image.jpg?t=20" />
            <img alt="" class="w33 hinge" src="./image.gif?t=20" />
          </article>
          <details open class="mp-allow tilt">
            <summary>types</summary>
            <table class="w100 mp-allow">
              <tr>
                <th>Property</th>
                <th>Value</th>
              </tr>
              <tr>
                <td>charmap</td>
                <td>&bigotimes;üêß</td>
              </tr>
              <tr>
                <td>comment</td>
                <td>
                  <!--comment-->
                  <![CDATA[ escape ]]>
                  <?php echo('hello world') ?>
                  <?xml version="1.0" encoding="UTF-8"?>
                  <xml>XML</xml>
                  <!--//__THREE__
                    const uri = '//raw.githubusercontent.com/mrdoob/three.js/dev/examples/models/json/suzanne_buffergeometry.json'
                    const loader = new THREE.BufferGeometryLoader();
                    loader.load( uri, function ( data ){
                      const material = new THREE.MeshBasicMaterial( { color: 0x00c0c0, wireframe: true } );
                      const object = new THREE.Mesh( data, material );
                      
                      let scale = 50;
                      object.scale.multiplyScalar( scale );
                      object.position.set( -scale, scale, 0 );
                      
                      mpos.var.grade.group.add( object );
                    });
                  -->
                  <script>
                    noscript
                  </script>
                </td>
              </tr>
              <tr>
                <td>object</td>
                <td>
                  <object data="//upload.wikimedia.org/wikipedia/commons/1/19/Tetrix_projection_fill_plane.svg"></object>
                </td>
              </tr>
              <tr>
                <td>iframe</td>
                <td>
                  <div class="yt mp-native">
                    <iframe src="//youtube.com/embed/joOIBteSo1w?vq=tiny" allow="encrypted-media;"></iframe>
                  </div>
                </td>
              </tr>
              <tr>
                <td>model-viewer</td>
                <td>
                  <script type="module" src="//ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
                  <model-viewer
                    ar
                    camera-controls
                    touch-action="pan-y"
                    src="//modelviewer.dev/shared-assets/models/Astronaut.glb"
                    alt="A 3D model of an astronaut"
                  >
                    <button slot="ar-button" style="border: none; position: absolute; top: 16px; right: 16px">üëã Activate AR</button>
                  </model-viewer>
                </td>
              </tr>
              <tr>
                <td>z-index</td>
                <td>
                  <span style="position: relative; z-index: auto">auto</span>
                  <span style="position: relative; z-index: 3">3</span>
                  <span style="position: relative; z-index: -6">-6</span>
                  <span style="position: relative; z-index: 99">99</span>
                </td>
              </tr>
            </table>
          </details>
        </section>
        <details id="live" class="mp-allow" open>
          <summary class="mp-native">section<span>#live</span></summary>

          <article>
            <h2>Article 01: Carousel</h2>
            <p>Media slides with content-aware policy.</p>
            <figure class="slides">
              <div class="track">
                <img alt="" srcset="data:," style="height: 8em; background-color: rgb(128, 0, 0)" />
                <figcaption>srcset</figcaption>
              </div>
              <picture class="track">
                <source alt="" src="data:," style="height: 8em; background-color: rgb(128, 32, 32)" />
                <figcaption>picture</figcaption>
              </picture>
              <div class="track">
                <img alt="" src="data:," style="height: 8em; background-color: rgb(128, 64, 64)" />
                <figcaption>source</figcaption>
              </div>
              <div class="track">
                <img alt="" src="data:," style="height: 8em; background-color: rgb(128, 128, 128)" />
                <figcaption>srcset-4</figcaption>
              </div>
            </figure>
            <ul>
              Proposal...
              <li>config: default, custom</li>
              <li>source: h264, MVC/SBS</li>
              <li>user-agent: advertisement</li>
            </ul>
          </article>
          <article>
            <h2>Article 02: Predictive</h2>
            <p>Defined slot to sample for systems.</p>
            <img alt="" class="w100" src="data:," style="height: 8em; background-color: rgb(0, 128, 0)" />
            <ul>
              Proposal...
              <li>script: cast data routine</li>
              <li>unify i/o: session layers</li>
              <li>handoff: XR, auto, foreign</li>
            </ul>
          </article>
          <article>
            <h2>Article 03: Indeterminate</h2>
            <p>Mutation and polymorphism and garbage.</p>
            <img alt="" class="w50" src="data:," style="height: 8em; background-color: rgb(0, 0, 128)" />
            <ul>
              Proposal...
              <li>alert: !!can or !!is in a coalmine</li>
              <li>ingest: contain or isolate</li>
              <li>seal: environment pipeline</li>
            </ul>
          </article>
        </details>
      </details>
    </main>
    <script>
      //
      // Await
      const mp = setInterval(() => {
        if (typeof window.mpos !== 'undefined') {
          clearInterval(mp)

          //
          // Extract some visual hierarchy

          mpos.fnVar('chain', '#overflow', { count: 4, symbol: '-' })
          mpos.fnVar('chain', '#underflow', { count: 4, symbol: '+' })

          mpos.fnVar('march', '#nest', {}).then(function (res) {
            mpos.fnVar('chain', '#nest', { count: res, symbol: res }).then((res) => {
              // Analogue of raymarch chain
              console.log('fnVar', res)
            })
          })

          //
          // Object Preload
          const Object3D = document.createElement('object')
          Object3D.classList.add('mp-loader')
          Object3D.data = '//raw.githubusercontent.com/mrdoob/three.js/master/examples/models/json/lightmap/lightmap.json'
          Object3D.style = 'display: block; width: 2em; height: 2em;'

          //
          // Initialize in standalone mode
          mpos.init().then((res) => {
            console.log('mpos:', res)

            //
            // Depth March
            mpos.fnVar('march', '#Object3D', {}).then(function (res) {
              // Count -1 so Object appears under Depth
              mpos.fnVar('chain', '#Object3D', { count: res - 1, symbol: '&#65532;' }).then((res) => {
                // Object Append
                res.querySelector('.last').append(Object3D)

                // DOM has Object, so add it
                mpos.add().then((res) => {
                  console.log('precept grade:', res)

                  // Find element rect, and flip-y
                  const idx = Object3D.getAttribute('data-idx')
                  mpos.fnVar('find', idx, {}).then(function (res) {
                    // ObjectLoader can complete later...?
                    console.log('find res.obj:', res)
                    // unlike rotateZ(), scale(-1, 0) flickers visibility
                    Object3D.style.transform = 'rotateZ(180deg)'
                  })
                })

                //
                //
              })
            })
          })

          //
          //
        }
      }, 250)

      //
      // User events (native or synthetic)
      document.body.addEventListener(
        'click',
        (e) => {
          const target = e.target
          target.classList.toggle('active')

          if (target.nodeName == 'VIDEO') {
            if (target.paused) target.play()
            else target.pause()
          }
        },
        false
      )
    </script>
  </body>
</html>
